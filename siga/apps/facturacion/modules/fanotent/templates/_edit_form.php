<?php
// auto-generated by PropelCidesa
// date: 2008/11/18 12:09:00
?>
<?php echo form_tag('fanotent/save', array(
  'id'        => 'sf_admin_edit_form',
  'name'      => 'sf_admin_edit_form',
  'multipart' => true,
)) ?>

<?php echo object_input_hidden_tag($fanotent, 'getId') ?>
<?php echo javascript_include_tag('dFilter','ajax','tools','observe','facturacion/notaentrega') ?>
<?php use_helper('Javascript', 'tabs', 'Grid') ?>

<?php echo input_hidden_tag('fanotent[codcli]', $fanotent->getCodcli()) ?>

<h2 class="h2" onclick="javascript: return $('divDatos Nota de Entrega').toggle();"><?php echo __('Datos Nota de Entrega') ?></h2>
<fieldset id="sf_fieldset_datos_nota_de_entrega" class="">

<div class="form-row" id="divDatos Nota de Entrega">

<table>
  <tr>
    <th>
		<div id="divnronot">
		  <?php echo label_for('fanotent[nronot]', __($labels['fanotent{nronot}' ]), 'class="required" Style="text-align:left; width:150px"') ?>
		  <div class="content<?php if ($sf_request->hasError('fanotent{nronot}')): ?> form-error<?php endif; ?>">
		  <?php if ($sf_request->hasError('fanotent{nronot}')): ?>
		    <?php echo form_error('fanotent{nronot}', array('class' => 'form-error-msg')) ?>
		  <?php endif; ?>

		  <?php $value = object_input_tag($fanotent, 'getNronot', array (
		  'size' => 8,
		  'control_name' => 'fanotent[nronot]',
		  'maxlength' => 8,
		  'onBlur'  => "javascript:event.keyCode=13; enters(event,this.value);",
		  'readonly'  =>  true,
		)); echo $value ? $value : '&nbsp;' ?>

		    </div>
		</div>
	<th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
	<th>
		<div id="divfecnot">
		  <?php echo label_for('fanotent[fecnot]', __($labels['fanotent{fecnot}' ]), 'class="required" Style="text-align:left; width:100px"') ?>
		  <div class="content<?php if ($sf_request->hasError('fanotent{fecnot}')): ?> form-error<?php endif; ?>">
		  <?php if ($sf_request->hasError('fanotent{fecnot}')): ?>
		    <?php echo form_error('fanotent{fecnot}', array('class' => 'form-error-msg')) ?>
		  <?php endif; ?>

		  <?php $value = object_input_date_tag($fanotent, 'getFecnot', array (
		  'rich' => true,
		  'calendar_button_img' => '/sf/sf_admin/images/date.png',
		  'control_name' => 'fanotent[fecnot]',
		  'date_format' => 'dd/MM/yyyy',
		  'maxlength' => 10,
		  'onkeyup' => "javascript: mascara(this,'/',patron,true)",
		  'readonly'  =>  $fanotent->getId()!='' ? true : false ,
		 ),date('Y-m-d')); echo $value ? $value : '&nbsp;' ?>

		    </div>
		</div>
	</th>
  </tr>
</table>
<br/>

<table>
  <tr>
    <th>
		<div id="divtipref">
		  <?php echo label_for('fanotent[tipref]', __($labels['fanotent{tipref}' ]), 'class="required" Style="text-align:left; width:150px"') ?>
		  <div class="content<?php if ($sf_request->hasError('fanotent{tipref}')): ?> form-error<?php endif; ?>">
		  <?php if ($sf_request->hasError('fanotent{tipref}')): ?>
		    <?php echo form_error('fanotent{tipref}', array('class' => 'form-error-msg')) ?>
		  <?php endif; ?>

           <?php echo select_tag('fanotent[tipref]', options_for_select(Constantes::ListaRefiereNotaEntrega(),$fanotent->getTipref(),'include_custom=Seleccione Uno'),array(
             'onchange' => "habilitarefere(this.id)",
             'onFocus'  =>  $fanotent->getId()!='' ? "this.blur()" : false ,
	       )) ?>

		    </div>
		</div>
	</th>
	<th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
	<th>
		<table>
			<tr>
				<th>
					<div id="divcodref">
					  <?php echo label_for('fanotent[codref]', __($labels['fanotent{codref}' ]), 'class="required" Style="text-align:left; width:150px"') ?>
					  <div class="content<?php if ($sf_request->hasError('fanotent{codref}')): ?> form-error<?php endif; ?>">
					  <?php if ($sf_request->hasError('fanotent{codref}')): ?>
					    <?php echo form_error('fanotent{codref}', array('class' => 'form-error-msg')) ?>
					  <?php endif; ?>

					  <?php $value = object_input_tag($fanotent, 'getCodref', array (
					  'size' => 20,
					  'control_name' => 'fanotent[codref]',
					  'readonly'  =>  $fanotent->getId()!='' ? true : false ,
					  'onBlur'=> 'colocargrid(this.id);'
					)); echo $value ? $value : '&nbsp;' ?>

					    </div>
					</div>
				</th>
				<th>
					<div id="divrefpedido">
				   <?php echo  button_to_popup('...',cross_app_link_to('herramientas','catalogo').'/metodo/Fapedido_Fanotent/clase/Fapedido/frame/sf_admin_edit_form/obj1/fanotent_codref/campo1/nroped/','','','botoncat')?></th>
					</div>
				</th>
				<th>
					<div id="divreffactura">
				   <?php echo  button_to_popup('...',cross_app_link_to('herramientas','catalogo').'/metodo/Factura_Fanotent/clase/Fafactur/frame/sf_admin_edit_form/obj1/fanotent_codref/campo1/reffac/','','','botoncat')?></th>
					</div>
				</th>
			</tr>
		</table>
	</th>
  </tr>
</table>

<br/>

<table>
  <tr>
    <th>
		<div id="divrifpro">
		  <?php echo label_for('fanotent[rifpro]', __($labels['fanotent{rifpro}' ]), 'class="required" Style="text-align:left; width:150px"') ?>
		  <div class="content<?php if ($sf_request->hasError('fanotent{rifpro}')): ?> form-error<?php endif; ?>">
		  <?php if ($sf_request->hasError('fanotent{rifpro}')): ?>
		    <?php echo form_error('fanotent{rifpro}', array('class' => 'form-error-msg')) ?>
		  <?php endif; ?>

			<?php $value = object_input_tag($fanotent, 'getRifpro', array (
			  'size' => 20,
			  'control_name' => 'fanotent[rifpro]',
			  'readonly'  =>  true,
			  'onKeyDown' => "javascript:return dFilter (event.keyCode, this)",
			  'onBlur'=> remote_function(array(
						  'url'      => 'fanotent/ajax',
						  'script' => true,
						  'complete' => 'AjaxJSON(request, json)',
						  'condition' => "$('fanotent_rifpro').value != ''",
			  			  'with' => "'ajax=1&cajtexmos=fanotent_nompro&codigo='+this.value"
						  ))
			  )); echo $value ? $value : '&nbsp;' ?>
			<th>
			   <?php echo  button_to_popup('...',cross_app_link_to('herramientas','catalogo').'/metodo/Rifcli_Fapedido/clase/Facliente/frame/sf_admin_edit_form/obj1/fanotent_rifpro/obj2/fanotent_nompro/campo1/rifpro/campo2/nompro','','','botoncat')?></th>
			</th>
			<th>
			  <?php $value = object_input_tag($fanotent, 'getNompro', array (
			  'size' => 80,
			  'disabled' => true,
			  'control_name' => 'fanotent[nompro]',
			)); echo $value ? $value : '&nbsp;' ?>
			</th>
		    </div>
		</div>
	</th>
  </tr>
</table>

<br/>

<table>
  <tr>
    <th>
		<div id="divdirpro">
		  <?php echo label_for('fanotent[dirpro]', __($labels['fanotent{dirpro}' ]), 'class="required" Style="text-align:left; width:150px"') ?>
		  <div class="content<?php if ($sf_request->hasError('fanotent{dirpro}')): ?> form-error<?php endif; ?>">
		  <?php if ($sf_request->hasError('fanotent{dirpro}')): ?>
		    <?php echo form_error('fanotent{dirpro}', array('class' => 'form-error-msg')) ?>
		  <?php endif; ?>

		  <?php $value = object_input_tag($fanotent, 'getDirpro', array (
		  'disabled' => true,
		  'size' => '100',
		  'control_name' => 'fanotent[dirpro]',
		)); echo $value ? $value : '&nbsp;' ?>
		    </div>
		</div>
	</th>
</table>

<br>

<table>
	<th>
		<div id="divtelpro">
		  <?php echo label_for('fanotent[telpro]', __($labels['fanotent{telpro}' ]), 'class="required" Style="text-align:left; width:150px"') ?>
		  <div class="content<?php if ($sf_request->hasError('fanotent{telpro}')): ?> form-error<?php endif; ?>">
		  <?php if ($sf_request->hasError('fanotent{telpro}')): ?>
		    <?php echo form_error('fanotent{telpro}', array('class' => 'form-error-msg')) ?>
		  <?php endif; ?>

		  <?php $value = object_input_tag($fanotent, 'getTelpro', array (
		  'disabled' => true,
		  'control_name' => 'fanotent[telpro]',
		)); echo $value ? $value : '&nbsp;' ?>
		    </div>
		</div>
	</th>
  </tr>
</table>

<br/>

<table>
  <tr>
    <th>
		<div id="divdesnot">
		  <?php echo label_for('fanotent[desnot]', __($labels['fanotent{desnot}' ]), 'class="required" Style="text-align:left; width:150px"') ?>
		  <div class="content<?php if ($sf_request->hasError('fanotent{desnot}')): ?> form-error<?php endif; ?>">
		  <?php if ($sf_request->hasError('fanotent{desnot}')): ?>
		    <?php echo form_error('fanotent{desnot}', array('class' => 'form-error-msg')) ?>
		  <?php endif; ?>

		  <?php $value = object_textarea_tag($fanotent, 'getDesnot', array (
		  'size' => '90x3',
		  'maxlength'=>250,
		  'control_name' => 'fanotent[desnot]',
		  'readonly'  =>  $fanotent->getId()!='' ? true : false ,
		)); echo $value ? $value : '&nbsp;' ?>
		    </div>
		</div>
	</th>
  </tr>
</table>

<br/>

<table>
	<tr>
		<th>
			<div id="divrifent">
			  <?php echo label_for('fanotent[rifent]', __($labels['fanotent{rifent}' ]), 'class="required" Style="text-align:left; width:150px"') ?>
			  <div class="content<?php if ($sf_request->hasError('fanotent{rifent}')): ?> form-error<?php endif; ?>">
			  <?php if ($sf_request->hasError('fanotent{rifent}')): ?>
			    <?php echo form_error('fanotent{rifent}', array('class' => 'form-error-msg')) ?>
			  <?php endif; ?>

				<?php echo input_auto_complete_tag('fanotent[rifent]', $fanotent->getRifent(),
				    'fanotent/autocomplete?ajax=2',  array('autocomplete' => 'off','maxlength' => 15,
				    	'readonly'  =>  $fanotent->getId()!='' ? true : false ,
						'onBlur'=> remote_function(array(
				        'url'      => 'fanotent/ajax',
				        'complete' => 'AjaxJSON(request, json)',
				        'condition' => "$('fanotent_rifent').value != ''",
				          'with' => "'ajax=3&cajtexmos=fanotent_noment&cajtexcom=fanotent_rifent&codigo='+this.value"
				        ))),
				     array('use_style' => 'true')
				  )?>
				</th>
				<th>
				   <?php echo  button_to_popup('...',cross_app_link_to('herramientas','catalogo').'/metodo/Rifcli_Fapedido/clase/Facliente/frame/sf_admin_edit_form/obj1/fanotent_rifent/obj2/fanotent_noment/campo1/rifpro/campo2/nompro','','','botoncat')?></th>
				</th>
				<th>
				  <?php $value = object_input_tag($fanotent, 'getNoment', array (
				  'size' => 80,
				  'disabled' => true,
				  'control_name' => 'fanotent[noment]',
				)); echo $value ? $value : '&nbsp;' ?>
				</th>
			    </div>
			</div>
		</th>
	</tr>
</table>

<br>

<table>
  <tr>
    <th>
		<div id="divtipnot">
		  <?php echo label_for('fanotent[tipnot]', __($labels['fanotent{tipnot}' ]), 'class="required" Style="text-align:left; width:150px"') ?>
		  <div class="content<?php if ($sf_request->hasError('fanotent{tipnot}')): ?> form-error<?php endif; ?>">
		  <?php if ($sf_request->hasError('fanotent{tipnot}')): ?>
		    <?php echo form_error('fanotent{tipnot}', array('class' => 'form-error-msg')) ?>
		  <?php endif; ?>

    	  <? if ($fanotent->getId() == ''){ ?>
		    <?  if ($fanotent->getTipnot()=='D'){
		      echo radiobutton_tag('fanotent[tipnot]','D', true) .'&nbsp;&nbsp;'. "Donación".'&nbsp;&nbsp;';
		      echo radiobutton_tag('fanotent[tipnot]','O', false) .'&nbsp;&nbsp;'. "Otro";
		    }else{
		      echo radiobutton_tag('fanotent[tipnot]','D', false) .'&nbsp;&nbsp;'. "Donación".'&nbsp;&nbsp;';
		      echo radiobutton_tag('fanotent[tipnot]','O', true) .'&nbsp;&nbsp;'. "Otro";
		    }    ?>
    	  <?}else{?>
		    <?  if ($fanotent->getTipnot()=='D'){
		      echo radiobutton_tag('fanotent[tipnot]','D', true, array('disabled' => 'true')) .'&nbsp;&nbsp;'. "Donación".'&nbsp;&nbsp;';
		      echo radiobutton_tag('fanotent[tipnot]','O', false, array('disabled' => 'true')) .'&nbsp;&nbsp;'. "Otro";
		    }else{
		      echo radiobutton_tag('fanotent[tipnot]','D', false, array('disabled' => 'true')) .'&nbsp;&nbsp;'. "Donación".'&nbsp;&nbsp;';
		      echo radiobutton_tag('fanotent[tipnot]','O', true, array('disabled' => 'true')) .'&nbsp;&nbsp;'. "Otro";
		    }    ?>
    	  <?}?>
		    </div>
		</div>
	</th>
	<th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
	<th>
		<div id="divmonnot">
		  <?php echo label_for('fanotent[monnot]', __($labels['fanotent{monnot}' ]), 'class="required" Style="text-align:left; width:150px"') ?>
		  <div class="content<?php if ($sf_request->hasError('fanotent{monnot}')): ?> form-error<?php endif; ?>">
		  <?php if ($sf_request->hasError('fanotent{monnot}')): ?>
		    <?php echo form_error('fanotent{monnot}', array('class' => 'form-error-msg')) ?>
		  <?php endif; ?>

		  <?php $value = object_input_tag($fanotent, array('getMonnot',true), array (
		  'size' => 10,
		  'readonly'  =>  true,
		  'onKeyPress' => 'return validaDecimal(event)',
		  'onBlur' => 'event.keyCode=13;return formatoDecimal(event,this.id)',
		  'control_name' => 'fanotent[monnot]',
		)); echo $value ? $value : '&nbsp;' ?>
		    </div>
		</div>
	</th>
  </tr>
</table>

</div>
</fieldset>
<h2 class="h2" onclick="javascript: return $('divDetalle Nota de Entrega').toggle();"><?php echo __('Detalle Nota de Entrega') ?></h2>
<fieldset id="sf_fieldset_detalle_nota_de_entrega" class="">

<div class="form-row" id="divDetalle Nota de Entrega">
<div id="divgrid">
  <?php echo label_for('fanotent[grid]', __($labels['fanotent{grid}' ]), 'class="required" Style="text-align:left; width:150px"') ?>
  <div class="content<?php if ($sf_request->hasError('fanotent{grid}')): ?> form-error<?php endif; ?>">
  <?php if ($sf_request->hasError('fanotent{grid}')): ?>
    <?php echo form_error('fanotent{grid}', array('class' => 'form-error-msg')) ?>
  <?php endif; ?>
  <div id="articulos">
  <?php //$value = get_partial('grid', array('type' => 'edit', 'fanotent' => $fanotent)); echo $value ? $value : '&nbsp;' ?>
	<form name="form1" id="form1">
	<?
	  include_partial('grid', array( 'fanotent' => $fanotent ));
	?>
	</form>

  </div>
    </div>
</div>
<br/>
</div>
</fieldset>
<h2 class="h2" onclick="javascript: return $('divObservación').toggle();"><?php echo __('Observación') ?></h2>
<fieldset id="sf_fieldset_observaci__n" class="">

<div class="form-row" id="divObservación">
<div id="divobsnot">
  <?php echo label_for('fanotent[obsnot]', __($labels['fanotent{obsnot}' ]), 'class="required" Style="text-align:left; width:150px"') ?>
  <div class="content<?php if ($sf_request->hasError('fanotent{obsnot}')): ?> form-error<?php endif; ?>">
  <?php if ($sf_request->hasError('fanotent{obsnot}')): ?>
    <?php echo form_error('fanotent{obsnot}', array('class' => 'form-error-msg')) ?>
  <?php endif; ?>

  <?php $value = object_textarea_tag($fanotent, 'getObsnot', array (
  'size' => '90x3',
  'maxlength'=>250,
  'control_name' => 'fanotent[obsnot]',
  'readonly'  =>  $fanotent->getId()!='' ? true : false ,
)); echo $value ? $value : '&nbsp;' ?>

    </div>
</div>
<br/>
</div>
</fieldset>

<?php include_partial('edit_actions', array('fanotent' => $fanotent)) ?>

</form>

<ul class="sf_admin_actions">
<li class="float-rigth">
<?php if (($fanotent->getId() != '') && ($fanotent->getStatus()!='N')) {?>
  <input type="button" name="Submit" value="Anular" class="sf_admin_action_delete" onclick="javascript:anular();" />
<?php }?>
</li>

      <li class="float-left"><?php if ($fanotent->getId()): ?>
<?php echo button_to(__('delete'), 'fanotent/delete?id='.$fanotent->getId(), array (
  'post' => true,
  'confirm' => __('Are you sure?'),
  'class' => 'sf_admin_action_delete',
)) ?><?php endif; ?>
</li>
  </ul>

<script type="text/javascript">
 $$('.botoncat')[0].disabled=true;
 $$('.botoncat')[1].disabled=true;
 $$('.botoncat')[2].disabled=true;
 $('fanotent_codref').readOnly=true;
 //$('divcodref').hide();
 //$('divreffactura').hide();
 $('divrefpedido').hide();

  var idf='<?php echo $fanotent->getId()?>';
  if (idf!="")
  {
     $('trigger_fanotent_fecnot').hide();
	 $$('.botoncat')[3].disabled=true;
	 //$$('.botoncat')[4].disabled=true;
  }

  function anular()
  {
    var referencia=$('fanotent_nronot').value;
    var nronot=$('fanotent_nronot').value;
    var fecnot=$('fanotent_fecnot').value;

    window.open('/facturacion'+getEnv()+'.php/fanotent/anular?nronot='+nronot+'&referencia='+referencia+'&fecnot='+fecnot,'...','menubar=no,toolbar=no,scrollbars=yes,width=700,height=400,resizable=yes,left=400,top=120');
  }

  function enters(e,valor)
  {
   if (e.keyCode==13 || e.keyCode==9)
   {
     if (valor!='')
     { valor=valor.pad(8, '0',0);}
     else{valor=valor.pad(8, '#',0);}

     $('fanotent_nronot').value=valor;

   }
  }

  function perderfocus(e,id,totcol)
 {
   var aux = id.split("_");
   var name=aux[0];
   var fil=parseInt(aux[1]);
   var col=parseInt(aux[2]);

   if (col!=totcol)
   {
    var colsig=col+1;
    var siguiente=name+"_"+fil+"_"+colsig;
   }
   else
   {
    var fila=fil+1;
   	var siguiente=name+"_"+fila+"_1";
   }

   if (e.keyCode==13 || e.keyCode==9)
   {
     if($(siguiente))
     {
      if (!$(siguiente).readOnly) $(siguiente).focus();
     }
   }
  }

 function habilitarefere(id)
 {
	 var neww='<?php echo $fanotent->getId()?>';
	 if ($(id).value!="" && neww=="")
	 {
	      $('fanotent_rifpro').value='';
	      $('fanotent_nompro').value='';
	      $('fanotent_telpro').value='';
	      $('fanotent_dirpro').value='';
	 	if ($(id).value=='F')
	 	{
	      $('fanotent_codref').readOnly=false;
	      $('fanotent_codref').value='';
	      $$('.botoncat')[1].disabled=false;
		  $('divreffactura').show();
		  $('divrefpedido').hide();
	 	}
	 	else if ($(id).value=='P')
	 	{
	      $('fanotent_codref').readOnly=false;
	      $('fanotent_codref').value='';
	      $$('.botoncat')[0].disabled=false;
		  $('divrefpedido').show();
		  $('divreffactura').hide();
	 	}
	 	else
	 	{
	      $('fanotent_codref').value='';
	 	}
	 }
	 else{
	      $('fanotent_codref').value='';
	      $('fanotent_codref').readOnly=true;
	      $$('.botoncat')[0].disabled=true;
	      $$('.botoncat')[1].disabled=true;
	      $('fanotent_rifpro').value='';
	      $('fanotent_nompro').value='';
	      $('fanotent_telpro').value='';
	      $('fanotent_dirpro').value='';
	 }
 }

function colocargrid(id)
{
 var neww='<?php echo $fanotent->getId()?>';
 if ($('fanotent_codref').value!="" && neww=="")
 {
  var cod=$(id).value;
  new Ajax.Updater('articulos', getUrlModulo()+'ajax', {asynchronous:true, evalScripts:true, onComplete:function(request, json){AjaxJSON(request, json)}, parameters:'ajax=1&tipref='+$('fanotent_tipref').value+'&cajtexmos=fanotent_rifpro&codigo='+cod});
 }

}


 </script>
